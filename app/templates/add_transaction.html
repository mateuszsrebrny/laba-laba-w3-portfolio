{% extends "base.html" %}
{% block content %}
    <h2>Add Transaction</h2>
    <div id="error-message" class="text-danger mb-2"></div>
	<script>
		document.addEventListener('htmx:responseError', function (event) {
			const xhr = event.detail.xhr;
			const errorContainer = document.getElementById('error-message');
			if (xhr.status === 409) {
				const errorMessage = JSON.parse(xhr.responseText).error; // Extract error message
				errorContainer.innerHTML = `<div class="alert alert-danger">${errorMessage}</div>`;
			} else {
				errorContainer.innerHTML = `<div class="alert alert-danger">An unknown error occurred.</div>`;
			}
		});
	</script>

    <form hx-post="/add" hx-target="#transaction-list" hx-indicator="#loading" hx-swap="beforeend">


        <div id="loading" class="htmx-indicator">Submitting...</div>
        <div id="transaction-list"></div>
        <label>Amount:</label>
        <input type="text" name="amount" required class="form-control">
        
        <label>Token:</label>
        <input type="text" name="token" required class="form-control">

        <label>Timestamp:</label>
        <input 
            id="timestamp"
            type="text" 
            name="timestamp" 
            required class="form-control"
            step="1"
            value="{{ now|datetimeformat }}"
        >

        <button type="submit" class="btn btn-success mt-2">Submit</button>
    </form>

    <a href="/" class="btn btn-secondary mt-2">Back to Transactions</a>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
	<script>
	flatpickr("#timestamp", {
	  enableTime: true,
	  enableSeconds: true,
	  time_24hr: true,
	  dateFormat: "Y-m-d\\TH:i:S",
	  defaultDate: new Date().toISOString().slice(0, 19)
	});
	</script>
{% endblock %}
